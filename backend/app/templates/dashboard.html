{% extends "base_sidebar.html" %}
{% block title %}{{ _('Dashboard') }} - WaveBulk{% endblock %}
{% block main_content_class %} full-width{% endblock %}
{% block content %}
<div class="container-full">
<div data-pending-count="{{ stats.pending_tasks }}"></div>
<section class="section-title mb-4">
        <h1>{{ _('Dashboard') }}</h1>
        <p>{{ _('Twoje podsumowanie i statystyki') }}</p>
    </section>

    <!-- Stats Cards Grid -->
    <div class="stats-grid mb-5">
        <div class="stat-card">
            <div class="stat-icon bg-primary">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z" />
                </svg>
            </div>
            <div class="stat-content">
                <div class="stat-label">{{ _('Wszystkie pliki') }}</div>
                <div class="stat-value">{{ stats.total_files }}</div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon bg-success">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </div>
            <div class="stat-content">
                <div class="stat-label">{{ _('Ukończone') }}</div>
                <div class="stat-value">{{ stats.completed_tasks }}</div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon bg-warning">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </div>
            <div class="stat-content">
                <div class="stat-label">{{ _('W trakcie') }}</div>
                <div class="stat-value">{{ stats.pending_tasks }}</div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon bg-info">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.114 5.636a9 9 0 010 12.728M16.463 8.288a5.25 5.25 0 010 7.424M6.75 8.25l4.72-4.72a.75.75 0 011.28.53v15.88a.75.75 0 01-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.01 9.01 0 012.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75z" />
                </svg>
            </div>
            <div class="stat-content">
                <div class="stat-label">{{ _('Średnia LUFS') }}</div>
                <div class="stat-value">{{ "%.1f"|format(stats.avg_lufs) if stats.avg_lufs else 'N/A' }}</div>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon bg-secondary">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z" />
                </svg>
            </div>
            <div class="stat-content">
                <div class="stat-label">{{ _('Zużyta przestrzeń') }}</div>
                <div class="stat-value">{{ (stats.total_storage_bytes / 1024 / 1024)|round(1) if stats.total_storage_bytes else '0' }} MB</div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions mb-5">
        <h2 class="section-subtitle">{{ _('Szybkie akcje') }}</h2>
        <div class="action-buttons-grid">
            <a href="{{ url_for('audio_processing.upload_and_process_audio') }}" class="action-button">
                <div class="action-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 16.5V9.75m0 0l3 3m-3-3l-3 3M6.75 19.5a4.5 4.5 0 01-1.41-8.775 5.25 5.25 0 0110.233-2.33 3 3 0 013.758 3.848A3.752 3.752 0 0118 19.5H6.75z" />
                    </svg>
                </div>
                <div class="action-content">
                    <h3>{{ _('Prześlij nowe pliki') }}</h3>
                    <p>{{ _('Rozpocznij nową konwersję') }}</p>
                </div>
            </a>

            <a href="{{ url_for('audio_processing.get_processing_history') }}" class="action-button">
                <div class="action-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </div>
                <div class="action-content">
                    <h3>{{ _('Zobacz historię') }}</h3>
                    <p>{{ _('Wszystkie Twoje konwersje') }}</p>
                </div>
            </a>

            {% if current_user.subscription_status != 'active' %}
            <a href="{{ url_for('main.pricing') }}" class="action-button highlight">
                <div class="action-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z" />
                    </svg>
                </div>
                <div class="action-content">
                    <h3>{{ _('Ulepsz do PRO') }}</h3>
                    <p>{{ _('Odblokuj wszystkie funkcje') }}</p>
                </div>
            </a>
            {% endif %}
        </div>
    </div>

    <!-- Recent Files -->
    <div class="recent-files-section">
        <div class="d-flex justify-between align-center mb-3">
            <h2 class="section-subtitle">{{ _('Ostatnie pliki') }}</h2>
            <a href="{{ url_for('audio_processing.get_processing_history') }}" class="btn btn-secondary btn-sm">{{ _('Zobacz wszystkie') }}</a>
        </div>

        {% if recent_files %}
        <div class="files-grid">
            {% for file in recent_files %}
            <div class="file-preview-card">
                <div class="file-preview-header">
                    <div class="file-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 9l10.5-3m0 6.553v3.75a2.25 2.25 0 01-1.632 2.163l-1.32.377a1.803 1.803 0 11-.99-3.467l2.31-.66a2.25 2.25 0 001.632-2.163zm0 0V2.25L9 5.25v10.303m0 0v3.75a2.25 2.25 0 01-1.632 2.163l-1.32.377a1.803 1.803 0 01-.99-3.467l2.31-.66A2.25 2.25 0 009 15.553z" />
                        </svg>
                    </div>
                    <div class="file-meta">
                        <h4 class="file-name">{{ file.filename }}</h4>
                        <span class="file-date">{{ file.upload_date.strftime('%Y-%m-%d %H:%M') }}</span>
                    </div>
                    <div class="file-status-badge">
                        {% if file.status == 'COMPLETED' %}
                            <span class="badge bg-success">✓</span>
                        {% elif file.status in ['PENDING', 'QUEUED', 'PROCESSING'] %}
                            <span class="badge bg-warning">⏳</span>
                        {% elif file.status == 'FAILED' %}
                            <span class="badge bg-danger">✗</span>
                        {% endif %}
                    </div>
                </div>
                
                {% if file.loudness_lufs %}
                <div class="file-preview-stats">
                    <div class="stat-item">
                        <span class="stat-label">LUFS:</span>
                        <span class="stat-value">{{ "%.1f"|format(file.loudness_lufs) }}</span>
                    </div>
                </div>
                {% endif %}
                
                <div class="file-preview-actions">
                    <a href="{{ url_for('audio_processing.file_details', file_id=file.id) }}" class="btn btn-secondary btn-sm">{{ _('Szczegóły') }}</a>
                    {% if file.processed_file_url %}
                        <a href="{{ file.processed_file_url }}" class="btn btn-primary btn-sm" download>{{ _('Pobierz') }}</a>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 9l10.5-3m0 6.553v3.75a2.25 2.25 0 01-1.632 2.163l-1.32.377a1.803 1.803 0 11-.99-3.467l2.31-.66a2.25 2.25 0 001.632-2.163zm0 0V2.25L9 5.25v10.303m0 0v3.75a2.25 2.25 0 01-1.632 2.163l-1.32.377a1.803 1.803 0 01-.99-3.467l2.31-.66A2.25 2.25 0 009 15.553z" />
            </svg>
            <h3>{{ _('Nie masz jeszcze żadnych plików') }}</h3>
            <p>{{ _('Rozpocznij konwersję, aby zobaczyć swoje pliki tutaj') }}</p>
            <a href="{{ url_for('audio_processing.upload_and_process_audio') }}" class="btn btn-primary mt-3">{{ _('Prześlij pierwszy plik') }}</a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
{% block scripts %}
    {{ super() }}
    <script src="{{ url_for('static', filename='js/dashboard.js') }}" defer></script>
{% endblock %}

